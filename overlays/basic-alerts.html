<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BASIC ALERTS - v.2.0.0 - tawmae.xyz</title>

  <script src="https://cdn.jsdelivr.net/npm/@streamerbot/client/dist/streamerbot-client.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@iconify/iconify@2.1.2/dist/iconify.min.js"></script>

  <style>
    :root {
      --accent-color: #5fa8ff;
      --card-bg: rgba(10, 14, 30, 0.9);
      --username-color: #ffffff;
      --event-text-color: #c9d7ff;
      --icon-color: var(--accent-color);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      overflow: hidden;
      background: transparent;
      font-family: "Poppins", sans-serif;
      color: #fff;
    }

    .alert-root {
      position: fixed;
      left: 50%;
      top: 5%;
      transform: translateX(-50%) translateY(-32px) scale(0.97);
      opacity: 0;
      pointer-events: none;
      transition:
        transform 0.55s cubic-bezier(0.2, 0.8, 0.2, 1),
        opacity 0.55s ease;
      z-index: 9999;
    }

    .alert-root.active {
      opacity: 1;
      transform: translateX(-50%) translateY(0) scale(1);
      pointer-events: auto;
    }

    .alert-card {
      display: flex;
      gap: 18px;
      align-items: center;
      padding: 14px 20px;
      border-radius: 18px;
      min-width: 420px;
      max-width: 640px;
      background:
        radial-gradient(circle at top left, rgba(125, 200, 255, 0.18), transparent 60%),
        radial-gradient(circle at bottom right, rgba(120, 80, 255, 0.2), transparent 60%),
        var(--card-bg);
      backdrop-filter: blur(16px);
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow:
        0 22px 46px rgba(0, 0, 0, 0.55),
        0 0 0 1px rgba(255, 255, 255, 0.03);
    }

    .alert-avatar-wrapper {
      position: relative;
      width: 82px;
      height: 82px;
      flex-shrink: 0;
    }

    .alert-avatar-glow {
      position: absolute;
      inset: 0;
      border-radius: 24px;
      background: conic-gradient(from 210deg,
          rgba(95, 168, 255, 0.4),
          rgba(167, 115, 255, 0.5),
          rgba(95, 168, 255, 0.4));
      filter: blur(7px);
      opacity: 0.7;
    }

    .alert-avatar-ring {
      position: absolute;
      inset: 0;
      border-radius: 24px;
      padding: 2px;
      background: linear-gradient(135deg, rgba(95, 168, 255, 0.85), rgba(167, 115, 255, 0.85));
    }

    .alert-avatar {
      width: 100%;
      height: 100%;
      border-radius: 20px;
      background-size: cover !important;
      background-position: center !important;
      background-color: #111827;
    }

    .alert-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 6px;
      min-width: 0;
    }

    .alert-username {
      font-weight: 800;
      font-size: 1.35rem;
      letter-spacing: 0.02em;
      color: var(--username-color);
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.75);
      white-space: nowrap;
      display: inline-flex;
    }

    .alert-username span {
      display: inline-block;
      animation: username-bounce 1.1s ease-in-out infinite;
    }

    @keyframes username-bounce {

      0%,
      100% {
        transform: translateY(0);
      }

      30% {
        transform: translateY(-1.5px);
      }

      60% {
        transform: translateY(1px);
      }
    }

    .alert-message {
      font-size: 0.98rem;
      font-weight: 600;
      color: var(--event-text-color);
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.75);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .alert-progress {
      margin-top: 6px;
      width: 100%;
      height: 4px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.75);
      overflow: hidden;
    }

    .alert-progress-inner {
      height: 100%;
      width: 100%;
      transform-origin: left center;
      transform: scaleX(0);
      background: linear-gradient(90deg, var(--accent-color), rgba(167, 115, 255, 0.9));
      box-shadow: 0 0 8px var(--accent-color);
    }

    .alert-icon {
      color: var(--icon-color);
      font-size: 2.7rem;
      width: 60px;
      height: 60px;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      animation: icon-linger 1.9s ease-in-out infinite;
      transform-origin: center;
    }

    @keyframes icon-linger {

      0%,
      100% {
        transform: translateY(0) scale(1) rotate(0deg);
      }

      20% {
        transform: translateY(-2px) scale(1.06) rotate(-6deg);
      }

      50% {
        transform: translateY(1px) scale(1.03) rotate(5deg);
      }

      75% {
        transform: translateY(-1px) scale(1.05) rotate(-3deg);
      }
    }

    @media (max-width: 640px) {
      .alert-card {
        min-width: 320px;
        max-width: 92vw;
        padding: 12px 14px;
      }

      .alert-avatar-wrapper {
        width: 70px;
        height: 70px;
      }

      .alert-icon {
        font-size: 2.2rem;
        width: 48px;
        height: 48px;
      }
    }
  </style>
</head>

<body>

  <div id="alert-root" class="alert-root" data-type="">
    <div class="alert-card">
      <div class="alert-avatar-wrapper">
        <div class="alert-avatar-glow"></div>
        <div class="alert-avatar-ring">
          <div id="profile-pic" class="alert-avatar"></div>
        </div>
      </div>

      <div class="alert-content">
        <div id="username" class="alert-username"></div>
        <div id="event-text" class="alert-message"></div>
        <div class="alert-progress">
          <div id="alert-progress-bar" class="alert-progress-inner"></div>
        </div>
      </div>

      <div class="alert-icon">
        <span id="event-icon" class="iconify"></span>
      </div>
    </div>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);

    const address = "127.0.0.1";
    const port = parseInt(params.get("port") || "8080", 10);
    const password = params.get("password") || undefined;

    const font = params.get("font") || "Poppins";
    const soundEnabled = params.get("sound") === "true";

    const boxColor = params.get("color");
    const usernameColorParam = params.get("usernamecolor");
    const eventColorParam = params.get("eventcolor");
    const iconColorParam = params.get("iconcolor");

    const duration = parseInt(params.get("duration")) || 7000;
    const anonymousFollows = params.get("anonymousfollows") === "true";

    let watchStreakParam = params.get("watchstreaks");
    const watchStreaksEnabled =
      watchStreakParam === null || watchStreakParam === ""
        ? true
        : watchStreakParam.toLowerCase() !== "false";

    function normalize(c) {
      return /^[0-9A-Fa-f]{6}$/.test(c || "") ? `#${c}` : c;
    }

    if (boxColor) {
      document.documentElement.style.setProperty("--card-bg", boxColor);
      const accent = normalize(boxColor);
      if (accent) document.documentElement.style.setProperty("--accent-color", accent);
    }

    const usernameColor = normalize(usernameColorParam);
    if (usernameColor)
      document.documentElement.style.setProperty("--username-color", usernameColor);

    const eventTextColor = normalize(eventColorParam);
    if (eventTextColor)
      document.documentElement.style.setProperty("--event-text-color", eventTextColor);

    const iconColor = normalize(iconColorParam);
    if (iconColor)
      document.documentElement.style.setProperty("--icon-color", iconColor);

    document.body.style.fontFamily = font;

    const sound = new Audio("https://tawmae.github.io/overlays/basic_alerts.mp3");
    sound.volume = 0.1;
    if (soundEnabled) sound.load();

    const queue = [];
    let active = false;

    function enqueue(type, evt) {
      queue.push({ event: { type }, data: evt?.data || {} });
      if (!active) processQueue();
    }

    async function processQueue() {
      if (!queue.length) {
        active = false;
        return;
      }

      active = true;
      const item = queue.shift();
      const type = item.event.type;

      if (type === "WatchStreak" && !watchStreaksEnabled) {
        active = false;
        processQueue();
        return;
      }

      const name = extractName(item, type);
      const eventText = formatText(item);
      const avatar = await fetchAvatar(name, type);
      const icon = iconFor(type);

      const root = document.getElementById("alert-root");
      const user = document.getElementById("username");
      const msg = document.getElementById("event-text");
      const avatarDiv = document.getElementById("profile-pic");
      const iconSpan = document.getElementById("event-icon");
      const bar = document.getElementById("alert-progress-bar");

      user.innerHTML = [...(name || "Unknown")].map(c => `<span>${c}</span>`).join("");
      msg.textContent = eventText;
      avatarDiv.style.backgroundImage = `url(${avatar})`;
      iconSpan.setAttribute("data-icon", icon);
      root.dataset.type = type;

      bar.style.transform = "scaleX(0)";
      root.classList.add("active");

      if (soundEnabled) {
        setTimeout(() => {
          sound.currentTime = 0;
          sound.play().catch(() => { });
        }, 170);
      }

      const start = performance.now();
      function anim(t) {
        const p = Math.min((t - start) / duration, 1);
        bar.style.transform = `scaleX(${p})`;
        if (p < 1) requestAnimationFrame(anim);
      }
      requestAnimationFrame(anim);

      setTimeout(() => {
        root.classList.remove("active");
        root.addEventListener(
          "transitionend",
          () => {
            processQueue();
          },
          { once: true }
        );
      }, duration);
    }

    function iconFor(t) {
      if (t.includes("Follow")) return "material-symbols-light:favorite";
      if (t.includes("Cheer")) return "mingcute:diamond-square-fill";
      if (t.includes("GiftBomb")) return "material-symbols:star";
      if (t.includes("GiftSub")) return "material-symbols:star";
      if (t.includes("Sub")) return "material-symbols:star";
      if (t.includes("Raid")) return "ion:people-sharp";
      if (t.includes("Donation")) return "material-symbols-light:money-bag-rounded";
      if (t.includes("WatchStreak")) return "icon-park-outline:fire";
      return "";
    }

    function extractName(item, type) {
      const d = item.data;
      if (type === "Follow" && anonymousFollows) return "SOMEONE";
      switch (type) {
        case "Follow": return d.user_name;
        case "Cheer": return d.message?.username;
        case "Sub": return d.user?.name;
        case "ReSub": return d.user?.name;
        case "GiftSub": return d.user?.name;
        case "GiftBomb": return d.user?.name;
        case "Raid": return d.from_broadcaster_user_name;
        case "Donation": return d.from;
        case "WatchStreak": return d.displayName;
      }
      return "User";
    }

    async function fetchAvatar(username, type) {
      if (type === "Follow" && anonymousFollows)
        return "https://raw.githubusercontent.com/tawmae/tawmae.github.io/refs/heads/main/assets/media/heart-png.png";

      if (type === "Donation")
        return "https://raw.githubusercontent.com/tawmae/tawmae.github.io/refs/heads/main/assets/media/kofi%20placeholder.webp";

      try {
        const r = await fetch(`https://decapi.me/twitch/avatar/${username}`);
        if (r.ok) return await r.text();
      } catch { }

      return "https://static-cdn.jtvnw.net/user-default-pictures-uv/13e5fa74-defa-11e9-809c-784f43822e80-profile_image-300x300.png";
    }

    function formatText(item) {
      const t = item.event.type;
      const d = item.data;
      const tierSource = d.sub_tier || d.subTier || "";
      const tier = tierSource ? `T${tierSource.charAt(0)}` : "Sub";

      switch (t) {
        case "Follow": return "just followed the channel!";
        case "Cheer": return `cheered with ${d.bits} bits!`;
        case "Sub": return `subscribed with a ${(d.is_prime || d.isPrime) ? "Prime" : tier} sub!`;
        case "ReSub": return `resubbed with a ${(d.is_prime || d.isPrime) ? "Prime" : tier} sub for the ${d.cumulativeMonths}. month!`;
        case "GiftSub": return `gifted a ${tier} sub to ${d.recipient?.name || "someone"}!`;
        case "GiftBomb": return `gifted ${d.total} ${tier} subs!`;
        case "Raid": return `raided with ${d.viewers} viewers!`;
        case "Donation": return `donated ${d.amount} ${d.currency}!`;
        case "WatchStreak": return `is on a ${d.watchStreak}x watchstreak!`;
        default: return "did something amazing!";
      }
    }

    function connect() {
      const client = new StreamerbotClient({
        host: address,
        port,
        password,
        logLevel: "verbose",
        reconnect: true,
        reconnectInterval: 5000
      });

      client.on("Twitch.Follow", e => enqueue("Follow", e));
      client.on("Twitch.Cheer", e => enqueue("Cheer", e));
      client.on("Twitch.Sub", e => enqueue("Sub", e));
      client.on("Twitch.ReSub", e => enqueue("ReSub", e));
      client.on("Twitch.GiftSub", e => enqueue("GiftSub", e));
      client.on("Twitch.GiftBomb", e => enqueue("GiftBomb", e));
      client.on("Twitch.Raid", e => enqueue("Raid", e));
      client.on("Twitch.WatchStreak", e => enqueue("WatchStreak", e));
      client.on("Kofi.Donation", e => enqueue("Donation", e));
    }

    window.addEventListener("load", connect);
  </script>

</body>

</html>
